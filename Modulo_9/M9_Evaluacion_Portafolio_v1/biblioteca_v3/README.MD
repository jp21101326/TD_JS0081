# ğŸ“š Sistema de Biblioteca de Libros

Sistema completo de gestiÃ³n de biblioteca con autenticaciÃ³n JWT, construido con Node.js, Express y Bootstrap.

## ğŸš€ CaracterÃ­sticas

- âœ… Registro e inicio de sesiÃ³n de usuarios con JWT
- âœ… CatÃ¡logo de libros con informaciÃ³n detallada
- âœ… Sistema de compra con validaciÃ³n de stock
- âœ… ProtecciÃ³n de rutas con middleware de autenticaciÃ³n
- âœ… Interfaz moderna con Bootstrap 5
- âœ… Soporte para JSON y PostgreSQL
- âœ… Panel de administrador
- âœ… Validaciones completas
- âœ… Mensajes informativos al usuario

## ğŸ› ï¸ TecnologÃ­as Utilizadas

- **Backend:** Node.js, Express
- **AutenticaciÃ³n:** JSON Web Token (JWT)
- **Base de datos:** JSON / PostgreSQL
- **Vistas:** Handlebars (HBS)
- **Frontend:** Bootstrap 5, JavaScript
- **Seguridad:** bcryptjs

## ğŸ“ Estructura del Proyecto

```
biblioteca-libros/
â”‚
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ database.js          # ConfiguraciÃ³n de PostgreSQL
â”‚   â””â”€â”€ jwt.js               # ConfiguraciÃ³n JWT
â”‚
â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ authController.js    # LÃ³gica de autenticaciÃ³n
â”‚   â””â”€â”€ librosController.js  # LÃ³gica de libros
â”‚
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ Usuario.js           # Modelo de Usuario
â”‚   â””â”€â”€ Libro.js             # Modelo de Libro
â”‚
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ authRoutes.js        # Rutas de autenticaciÃ³n
â”‚   â””â”€â”€ librosRoutes.js      # Rutas de libros
â”‚
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ authMiddleware.js    # Middleware JWT
â”‚
â”œâ”€â”€ views/
â”‚   â”œâ”€â”€ layouts/
â”‚   â”‚   â””â”€â”€ main.hbs         # Layout principal
â”‚   â”œâ”€â”€ home.hbs             # PÃ¡gina de inicio
â”‚   â”œâ”€â”€ register.hbs         # Registro
â”‚   â”œâ”€â”€ login.hbs            # Inicio de sesiÃ³n
â”‚   â”œâ”€â”€ libros.hbs           # CatÃ¡logo
â”‚   â””â”€â”€ admin.hbs            # Panel admin
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ libros.json          # Datos de libros
â”‚   â””â”€â”€ usuarios.json        # Datos de usuarios
â”‚
â”œâ”€â”€ .env                     # Variables de entorno
â”œâ”€â”€ index.js                 # Archivo principal
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## ğŸ“¦ InstalaciÃ³n

### 1. Clonar el repositorio

```bash
git clone <tu-repositorio>
cd biblioteca-libros
```

### 2. Instalar dependencias

```bash
npm install
```

### 3. Configurar variables de entorno

Crear archivo `.env` en la raÃ­z del proyecto:

```env
PORT=3000
NODE_ENV=development
JWT_SECRET=tu_clave_secreta_muy_segura
STORAGE_MODE=json

# Solo si usas PostgreSQL
DB_HOST=localhost
DB_PORT=5432
DB_NAME=biblioteca
DB_USER=postgres
DB_PASSWORD=tu_password
```

### 4. (Opcional) Configurar PostgreSQL

Si deseas usar PostgreSQL en lugar de JSON:

```sql
CREATE DATABASE biblioteca;
```

Cambiar en `.env`:
```env
STORAGE_MODE=postgres
```

Las tablas se crearÃ¡n automÃ¡ticamente al iniciar el servidor.

### 5. Iniciar el servidor

**Modo desarrollo:**
```bash
npm run dev
```

**Modo producciÃ³n:**
```bash
npm start
```

El servidor estarÃ¡ disponible en: `http://localhost:3000`

## ğŸ” API Endpoints

### AutenticaciÃ³n

#### Registrar Usuario
```http
POST /api/auth/register
Content-Type: application/json

{
  "username": "usuario123",
  "password": "contraseÃ±a123"
}
```

**Respuesta exitosa:**
```json
{
  "success": true,
  "message": "Usuario registrado exitosamente",
  "data": {
    "id": 1,
    "username": "usuario123",
    "created_at": "2024-01-01T00:00:00.000Z"
  }
}
```

#### Iniciar SesiÃ³n
```http
POST /api/auth/login
Content-Type: application/json

{
  "username": "usuario123",
  "password": "contraseÃ±a123"
}
```

**Respuesta exitosa:**
```json
{
  "success": true,
  "message": "Inicio de sesiÃ³n exitoso",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "username": "usuario123"
    }
  }
}
```

### Libros

#### Listar todos los libros (PÃºblico)
```http
GET /api/libros
```

**Respuesta:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "nombre": "Cien AÃ±os de Soledad",
      "autor": "Gabriel GarcÃ­a MÃ¡rquez",
      "precio": 15000,
      "cantidad_disponible": 10
    }
  ],
  "count": 5
}
```

#### Obtener libro por ID (PÃºblico)
```http
GET /api/libros/:id
```

#### Comprar libro (Requiere autenticaciÃ³n)
```http
POST /api/libros/:id/comprar
Authorization: Bearer <token>
Content-Type: application/json

{
  "cantidad": 2
}
```

**Respuesta exitosa:**
```json
{
  "success": true,
  "message": "Compra realizada exitosamente. 2 unidad(es) de \"Cien AÃ±os de Soledad\"",
  "data": {
    "libro": "Cien AÃ±os de Soledad",
    "cantidad_comprada": 2,
    "cantidad_restante": 8,
    "total": 30000,
    "comprador": "usuario123"
  }
}
```

**Respuesta con error (stock insuficiente):**
```json
{
  "success": false,
  "message": "Stock insuficiente. Solo hay 3 unidades disponibles"
}
```

#### Importar JSON a PostgreSQL (Admin)
```http
POST /api/libros/admin/import-json
Authorization: Bearer <token>
```

## ğŸ–¥ï¸ Vistas Disponibles

### PÃ¡ginas Web

1. **Inicio** - `http://localhost:3000/`
2. **Registro** - `http://localhost:3000/register-page`
3. **Login** - `http://localhost:3000/login-page`
4. **CatÃ¡logo** - `http://localhost:3000/libros-page`
5. **Admin** - `http://localhost:3000/admin-page`

## ğŸ”’ Seguridad

- ContraseÃ±as hasheadas con bcrypt
- AutenticaciÃ³n mediante JWT
- ValidaciÃ³n de datos en el servidor
- ProtecciÃ³n de rutas sensibles
- Tokens con expiraciÃ³n de 24 horas

## ğŸ“ Validaciones

### Registro de Usuario
- Username requerido
- Password mÃ­nimo 6 caracteres
- Username Ãºnico (no se permiten duplicados)

### Compra de Libros
- Usuario debe estar autenticado
- Cantidad debe ser mayor a 0
- Cantidad debe ser un nÃºmero entero
- Stock debe ser suficiente
- Libro debe existir

## ğŸ¨ CaracterÃ­sticas de la Interfaz

- DiseÃ±o moderno y responsivo
- Mensajes de Ã©xito/error claros
- Indicadores de stock
- CÃ¡lculo automÃ¡tico de totales
- ValidaciÃ³n en tiempo real
- Experiencia de usuario intuitiva

## ğŸ”„ Flujo de Uso

1. **Usuario se registra** en `/register-page`
2. **Inicia sesiÃ³n** en `/login-page` y recibe un token JWT
3. **Explora el catÃ¡logo** en `/libros-page`
4. **Selecciona un libro** y hace clic en "Comprar"
5. **Especifica la cantidad** deseada
6. **Confirma la compra** si hay stock disponible
7. **El sistema descuenta** del inventario y muestra confirmaciÃ³n

## ğŸ› Manejo de Errores

El sistema maneja todos los errores comunes:

- Usuario ya existe
- Credenciales invÃ¡lidas
- Token expirado o invÃ¡lido
- Stock insuficiente
- Libro no encontrado
- Cantidad invÃ¡lida
- Errores de base de datos

## ğŸ“Š Modo de Almacenamiento

### JSON (Por defecto)
- Los datos se guardan en archivos JSON
- Ideal para desarrollo y pruebas
- No requiere configuraciÃ³n adicional
- Datos en `/data/libros.json` y `/data/usuarios.json`

### PostgreSQL
- Base de datos robusta para producciÃ³n
- Transacciones para compras seguras
- Mejor rendimiento con muchos datos
- Requiere configuraciÃ³n en `.env`

### Cambiar entre modos

En el archivo `.env`:
```env
STORAGE_MODE=json    # Para usar JSON
STORAGE_MODE=postgres # Para usar PostgreSQL
```

## ğŸ§ª Probar la API

### Con cURL

**Registrar usuario:**
```bash
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","password":"test123"}'
```

**Iniciar sesiÃ³n:**
```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","password":"test123"}'
```

**Listar libros:**
```bash
curl http://localhost:3000/api/libros
```

**Comprar libro:**
```bash
curl -X POST http://localhost:3000/api/libros/1/comprar \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer TU_TOKEN_AQUI" \
  -d '{"cantidad":1}'
```

### Con Postman/Insomnia

Importa las siguientes colecciones para probar todos los endpoints.

## ğŸ“¦ Despliegue

### Preparar para producciÃ³n

1. Cambiar `NODE_ENV` a `production`
2. Usar una clave JWT segura y Ãºnica
3. Configurar PostgreSQL en producciÃ³n
4. Configurar variables de entorno seguras

### Plataformas recomendadas

- **Railway**
- **Render**
- **Heroku**
- **DigitalOcean**
- **AWS**

## ğŸ¤ Contribuir

Este proyecto fue desarrollado como parte de un portafolio acadÃ©mico. Â¡Las sugerencias son bienvenidas!

## ğŸ“„ Licencia

Este proyecto es de cÃ³digo abierto y estÃ¡ disponible bajo la licencia ISC.

## ğŸ‘¨â€ğŸ’» Autor

Desarrollado para evaluaciÃ³n de portafolio.

## ğŸ“ Soporte

Si encuentras algÃºn problema o tienes preguntas:

1. Revisa la documentaciÃ³n
2. Verifica las variables de entorno
3. Consulta los logs del servidor
4. Abre un issue en el repositorio

---

Â¡Gracias por usar el Sistema de Biblioteca de Libros! ğŸ“šâœ¨